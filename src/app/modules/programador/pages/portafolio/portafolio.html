<div class="programador-banner">
  <!-- encabezado del panel -->
  <div class="banner-content">
    <h1>PANEL DEL PROGRAMADOR</h1>
    <p>GESTIONA PROYECTOS, ASESOR√çAS Y TU PERFIL</p>
  </div>
</div>

<div class="programador-canvas">
  <!-- men√∫ interno para cambiar entre secciones -->
  <div class="menu-interno">
    <button (click)="vista = 'agregar'" [class.activo]="vista === 'agregar'">
      ‚ûï Agregar Proyecto
    </button>
    <button (click)="vista = 'proyectos'" [class.activo]="vista === 'proyectos'">
      üìÅ Mis Proyectos
    </button>
    <button (click)="vista = 'asesorias'" [class.activo]="vista === 'asesorias'">
      üì¨ Mis Asesor√≠as
    </button>
    <button (click)="vista = 'perfil'" [class.activo]="vista === 'perfil'">üë§ Mi Perfil</button>
  </div>

  <div class="programador-card">
    <!-- seccion: agregar proyecto -->
    <div *ngIf="vista === 'agregar'" class="seccion">
      <h3>Agregar nuevo proyecto</h3>

      <!-- formulario bidireccional con ngModel -->
      <form (ngSubmit)="guardarProyecto()" class="formulario">
        <label>Nombre del proyecto</label>
        <input type="text" [(ngModel)]="nuevoProyecto.nombre" name="nombre" required />

        <label>Descripci√≥n</label>
        <textarea [(ngModel)]="nuevoProyecto.descripcion" name="descripcion" required></textarea>

        <!-- agrupaci√≥n visual de tipo y rol -->
        <div class="doble">
          <div>
            <label>Tipo de proyecto</label>
            <select [(ngModel)]="nuevoProyecto.tipo" name="tipo" required>
              <option value="academico">Acad√©mico</option>
              <option value="laboral">Laboral</option>
            </select>
          </div>

          <div>
            <label>Rol</label>
            <select [(ngModel)]="nuevoProyecto.participacion" name="participacion" required>
              <option value="frontend">Frontend</option>
              <option value="backend">Backend</option>
              <option value="base-datos">Base de datos</option>
            </select>
          </div>
        </div>

        <label>Tecnolog√≠as usadas</label>
        <input type="text" [(ngModel)]="nuevoProyecto.tecnologias" name="tecnologias" />

        <label>Repositorio (GitHub)</label>
        <input type="text" [(ngModel)]="nuevoProyecto.repositorio" name="repositorio" />

        <label>URL de despliegue</label>
        <input type="text" [(ngModel)]="nuevoProyecto.deploy" name="deploy" />

        <button type="submit" class="btn-guardar">Guardar proyecto</button>
      </form>
    </div>

    <!-- seccion: listar proyectos -->
    <div *ngIf="vista === 'proyectos'" class="seccion">
      <!-- buscador din√°mico -->
      <input
        class="buscador"
        type="text"
        placeholder="Buscar proyecto..."
        [(ngModel)]="filtroProyecto"
        (input)="filtrarProyectos()"
      />

      <!-- lista generada desde Firestore -->
      <div class="tarjeta" *ngFor="let p of proyectosFiltrados">
        <h3>{{ p.nombre }}</h3>
        <p><strong>Tecnolog√≠as:</strong> {{ p.tecnologias }}</p>
        <p>{{ p.descripcion }}</p>

        <!-- botones acciones -->
        <div class="acciones">
          <button (click)="editarProyecto(p)">Editar</button>
          <button class="eliminar-btn" (click)="confirmarEliminarProyecto(p.id)">Eliminar</button>
        </div>
      </div>
    </div>

    <!-- seccion: editar proyecto existente -->
    <div *ngIf="vista === 'editar-proyecto'" class="seccion">
      <h3>Editar proyecto</h3>

      <form (ngSubmit)="actualizarProyecto()" class="formulario">
        <label>Nombre del proyecto</label>
        <input type="text" [(ngModel)]="proyectoEditando.nombre" name="editNombre" required />

        <label>Descripci√≥n</label>
        <textarea
          [(ngModel)]="proyectoEditando.descripcion"
          name="editDescripcion"
          required
        ></textarea>

        <div class="doble">
          <div>
            <label>Tipo</label>
            <select [(ngModel)]="proyectoEditando.tipo" name="editTipo">
              <option value="academico">Acad√©mico</option>
              <option value="laboral">Laboral</option>
            </select>
          </div>

          <div>
            <label>Rol</label>
            <select [(ngModel)]="proyectoEditando.participacion" name="editRol">
              <option value="frontend">Frontend</option>
              <option value="backend">Backend</option>
              <option value="base-datos">Base de datos</option>
            </select>
          </div>
        </div>

        <label>Tecnolog√≠as</label>
        <input type="text" [(ngModel)]="proyectoEditando.tecnologias" name="editTec" />

        <label>Repositorio</label>
        <input type="text" [(ngModel)]="proyectoEditando.repositorio" name="editRepo" />

        <label>Deploy</label>
        <input type="text" [(ngModel)]="proyectoEditando.deploy" name="editDeploy" />

        <button type="submit" class="btn-guardar">Guardar cambios</button>
        <button type="button" class="btn-secundario" (click)="vista = 'proyectos'">Cancelar</button>
      </form>
    </div>

    <!-- seccion: gestionar asesor√≠as -->
    <div *ngIf="vista === 'asesorias'" class="seccion">
      <h3>Solicitudes de Asesor√≠a</h3>

      <div *ngIf="asesorias.length === 0">No tienes solicitudes a√∫n</div>

      <div class="tarjeta" *ngFor="let a of asesorias">
        <p>
          <strong>Fecha:</strong>
          {{ a.fecha | date: 'yyyy-MM-dd' }} {{ a.hora }}
        </p>

        <p>
          <strong>Usuario:</strong>
          {{ a.nombreCliente }}
        </p>

        <p>
          <strong>Correo:</strong>
          {{ a.correoCliente }}
        </p>

        <p>
          <strong>Mensaje:</strong>
          {{ a.mensaje }}
        </p>

        <p>
          <strong>Proyecto:</strong>
          <span *ngIf="a.project; else sinProyecto">
            {{ a.project.nombre }}
          </span>
          <ng-template #sinProyecto>
            <em>No tiene ning√∫n proyecto seleccionado</em>
          </ng-template>
        </p>

        <p>
          <strong>Estado:</strong>
          <span [class]="a.estado">
            {{ a.estado }}
          </span>
        </p>

        <div class="acciones">
          <button *ngIf="a.estado === 'PENDIENTE'" (click)="responder(a.id, 'CONFIRMADA')">
            ‚úî Aprobar
          </button>

          <button *ngIf="a.estado === 'PENDIENTE'" (click)="responder(a.id, 'RECHAZADA')">
            ‚úñ Rechazar
          </button>

          <button
            *ngIf="a.estado !== 'PENDIENTE'"
            class="eliminar-btn"
            (click)="confirmarEliminarAsesoria(a.id)"
          >
            üóë Eliminar
          </button>
        </div>
      </div>
    </div>

    <!-- seccion: perfil programador -->
    <div *ngIf="vista === 'perfil'" class="perfil-container">
      <h2>Mi Perfil</h2>

      <!-- foto editable con Firebase Storage -->
      <div class="foto-container">
        <img [src]="perfil.photo || 'assets/img/default-user.png'" class="foto-perfil" />
        <label class="btn-foto">
          Cambiar foto
          <input type="file" accept="image/*" (change)="subirFoto($event)" />
        </label>
      </div>

      <!-- formulario de informaci√≥n personal -->
      <form (ngSubmit)="guardarPerfil()" class="formulario">
        <label>Nombre</label>
        <input type="text" [(ngModel)]="perfil.name" name="nombre" required />

        <label>Especialidad</label>
        <input type="text" [(ngModel)]="perfil.specialty" name="specialty" />

        <label>Descripci√≥n</label>
        <textarea [(ngModel)]="perfil.description" name="description"></textarea>

        <label>GitHub</label>
        <input type="text" [(ngModel)]="perfil.github" name="github" />

        <label>LinkedIn</label>
        <input type="text" [(ngModel)]="perfil.linkedin" name="linkedin" />

        <label>Instagram</label>
        <input type="text" [(ngModel)]="perfil.instagram" name="instagram" />

        <label>Sitio Web</label>
        <input type="text" [(ngModel)]="perfil.website" name="website" />

        <button type="submit" class="btn-guardar">Guardar cambios</button>
      </form>
    </div>
  </div>
</div>

<!-- modal: mensajes -->
<div class="overlay" *ngIf="mostrarModalMensaje">
  <div class="confirm-modal animate">
    <h2>Notificaci√≥n</h2>
    <p>{{ mensajeModal }}</p>
    <button class="close-btn" (click)="mostrarModalMensaje = false">Cerrar</button>
  </div>
</div>

<!-- modal: confirmaciones -->
<div class="overlay" *ngIf="mostrarModalConfirmacion">
  <div class="confirm-modal animate">
    <h2>‚ö† Confirmaci√≥n</h2>
    <p>{{ mensajeModal }}</p>
    <div class="btn-row">
      <button class="close-btn cancel" (click)="cancelarAccion()">Cancelar</button>
      <button class="close-btn confirm" (click)="confirmarAccion()">S√≠, continuar</button>
    </div>
  </div>
</div>
